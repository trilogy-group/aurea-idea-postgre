<?xml version="1.0" encoding="UTF-8"?>
<!--
This spec is used to update organization party into DCM, organization party page available under Party (Tab) - Search for Organization

Data File Format:
Tax ID,Name,Agency Formation Date,Role,Description,DBA,Organization Type,CRD Number,DTCCID,NPN,Party Role,Party Type,Renewal Fee Payee,Status Code,Status Start Date,Status End Date,User

Sample Data:
SA_123,Savvion_Aurea_Accolite_India Pvt Ltd,1/1/1950,APPOINTINGCOMPANY,Description,DBA 2,OrgType,SA_CRD_123,SA22,124578,Selling Agent,Compensation only,Distributor,Recontractable,1/1/2000,1/1/2020,sa

How to run:
ant LoadFile -Denvironment=DCM -DSPEC_FILE={File-Location}/InsertPersonPartySpec.xml -DDATA_FILE={File-Location}/InsertPersonPartyData.csv -DOUTPUT_DIR={Temp-Dir} -DBATCH_SIZE=100

-->
<loader:loader_spec xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:loader="http://dms.trilogy.com/Loader/Spec" xmlns="http://dms.trilogy.com/Loader/Spec" xsi:schemaLocation="http://dms.trilogy.com/Loader/Spec LoaderSpec.xsd" name="Update Org Parties Loader Spec">
	<error_handlers>
		<handler name="idea_log_error_handler" class="log_message_error_handler">
			<property name="filename" value="${OUTPUT_DIR}/${ERROR_FILENAME}"/>
		</handler>
	</error_handlers>
	<strategy name="strategy" class="${STRATEGY}">
		<property name="memory.batch_size" value="${BATCH_SIZE}"/>
		<property name="exitIfSanityCheckFails" value="${SANITY_CHECK}"/>
	</strategy>
	<object name="org_party" class="OrgPartyUIValidator"/>
	<source name="load_file" class="delimited_file_parser">
		<property name="filename" value="${FILENAME}"/>
		<property name="delimiters" value=","/>
		<property name="headerRows" value="1"/>
		<property name="quote_chars" value="&quot;"/>
		<indexed_field name="tax id" index="0"/>
		<indexed_field name="name" index="1"/>
		<indexed_field name="agency formation date" index="2" translator="date_translator"/>
		<indexed_field name="role" index="3" translator="role_translator"/>
		<indexed_field name="description" index="4"/>
		<indexed_field name="dba" index="5"/>
		<indexed_field name="organization type" index="6" translator="org_type_translator"/>
		<indexed_field name="crd number" index="7"/>
		<indexed_field name="dtcc id" index="8"/>
		<indexed_field name="npn" index="9"/>
		<indexed_field name="party role" index="10"/>
		<indexed_field name="party type" index="11"/>
		<indexed_field name="renewal fee payee" index="12"/>
		<indexed_field name="status code" index="13" translator="status_code_translator"/>
		<indexed_field name="status reason" index="14"/>
		<indexed_field name="status start date" index="15" translator="date_translator"/>
		<indexed_field name="status end date" index="16" translator="date_translator"/>
		<indexed_field name="usr" index="17"/>
		<indexed_field name="syncWithPDB" index="18" translator="boolean_translator"/>
		
		<indexed_field name="Initial Contract Date" index="19" translator="date_translator"/>
		<indexed_field name="Background Check Waived for Assoc Persons" index="20" translator="boolean_translator"/>
		<indexed_field name="Selling Agreement on File" index="21" translator="boolean_translator"/>
		<indexed_field name="Selling Agreement Version" index="22"/>
		<indexed_field name="Selling Agreement Date" index="23" translator="date_translator"/>
		<indexed_field name="AML Exclusion for Associated Person Parties" index="24" translator="boolean_translator"/>
		<indexed_field name="EO Waived for Associated Parties" index="25" translator="boolean_translator"/>
		<indexed_field name="Business Type" index="26" translator="business_type_translator"/>
		<indexed_field name="LOP Exempt Until Date" index="27" translator="date_translator"/>
		<indexed_field name="LOP Exempt Reason" index="28" translator="lop_exempt_reason_translator"/>
		<indexed_field name="LOP Exempt Requester" index="29"/>
        
        <indexed_field name="Comp Discussed with Rep" index="30" translator="boolean_translator"/>
        <indexed_field name="Restricted Communication" index="31" translator="boolean_translator"/>
        <!--<indexed_field name="Advancing Commissions" index="32" translator="boolean_translator"/>-->
        <indexed_field name="Advancing Chargeback Timeframe" index="33"/>
        <!--<indexed_field name="Netting of Commissions" index="34" translator="boolean_translator"/>-->
        <!--<indexed_field name="Custodial Business" index="35" translator="boolean_translator"/>-->
        <!--<indexed_field name="Order Entry" index="36" translator="boolean_translator"/>-->
        <indexed_field name="Order Entry Source" index="37"/>
        <indexed_field name="E-Application" index="38" translator="boolean_translator"/>
        <indexed_field name="E-Application  Source" index="39"/>
        <indexed_field name="Distributor Account ID Required" index="40" translator="boolean_translator"/>
        <indexed_field name="Dicretionary Authority" index="41" translator="boolean_translator"/>
        <indexed_field name="Access to Website" index="42" translator="boolean_translator"/>
        <indexed_field name="Earn Eligible" index="43" translator="boolean_translator"/>
        <indexed_field name="Incentive Trip Eligible" index="44" translator="boolean_translator"/>
        <indexed_field name="Experience Eligible" index="45" translator="boolean_translator"/>
        <indexed_field name="Back Office Code" index="46"/>
        <!--<indexed_field name="Suitability Delegation to BD or Bank" index="47" translator="boolean_translator"/>-->
        <indexed_field name="Contract Mailing Destination" index="48"/>
        <!--<indexed_field name="Held Comp Bypass" index="49"/>-->
        <indexed_field name="DOL Effective Date" index="50" translator="date_translator"/>
        <indexed_field name="DOL FI Status" index="51"/>
        <indexed_field name="AVAdvOnClientInitFunds" index="52" translator="boolean_translator"/>   
        <indexed_field name="AVIPCOnFile" index="53" translator="boolean_translator"/>
		<indexed_field name="AVIPCEffectiveDate" index="54" translator="date_translator"/>
		<indexed_field name="AVIPCVersion" index="55"/>
	</source>
	<translator name="fi_status_translator" class="enum_translator">
		<property name="enumName" value="AVDOLFIStatus"/>
	</translator>
	<translator name="date_translator" class="com.aviva.fs.dms.tools.loader.translate.AVDateFormatTranslator">
		<property name="formatString" value="MM/dd/yyyy"/>
		<property name="treatEmptyAsNull" value="true"/>
	</translator>
		<translator name="role_translator" class="com.trilogy.fs.dms.tools.loader.translate.MultiRoleTranslator">
		<property name="delimiter" value="|"/>
	</translator>
	<translator name="country_translator" class="enum_translator">
		<property name="enumName" value="COUNTRY"/>
	</translator>
	<translator name="party_role_translator" class="enum_translator">
		<property name="enumName" value="PartyRole"/>
	</translator>
	<translator name="party_type_translator" class="enum_translator">
		<property name="enumName" value="PartyType"/>
	</translator>
	<translator name="renewal_fee_payee_translator" class="enum_translator">
		<property name="enumName" value="RenewalFeePayee"/>
	</translator>
		<translator name="status_code_translator" class="enum_translator">
		<property name="enumName" value="PartyUI.RecontractableStatus"/>
	</translator>
		<translator name="status_reason_translator" class="com.aviva.fs.dms.tools.loader.translate.AVPartyStatusReasonTranslator">
		<property name="statusReasonBaseEnumName" value="Party.RecontractableStatus.Reason"/>
		<property name="statusEnumName" value="PartyUI.RecontractableStatus"/>
	</translator>
	<translator name="boolean_translator" class="boolean_translator">
		<property name="true" value="true"/>
		<property name="false" value="false"/>
	</translator>
	<translator name="org_type_translator" class="enum_translator">
		<property name="enumName" value="OrgType"/>
	</translator>
	<translator name="business_type_translator" class="enum_translator">
		<property name="enumName" value="BusinessType"/>
	</translator>
	<translator name="lop_exempt_reason_translator" class="enum_translator">
		<property name="enumName" value="LOPExemptReason"/>
		<property name="throwException" value="true"/>
		<property name="useDefaultValue" value="false"/>		
	</translator>
	<translator name="lop_date_translator" class="select_first_available_translator">
		<property name="defaultValue" value="01/01/1900"/>
	</translator>

    <translator name="AVAdvancingChargebackTimeframe_enum_translator" class="enum_translator">
        <property name="enumName" value="AVAdvancingChargebackTimeframe"/>
		<property name="throwException" value="true"/>
		<property name="useDefaultValue" value="false"/>
    </translator>
    <translator name="AVOrderEntrySource_enum_translator" class="enum_translator">
        <property name="enumName" value="AVOrderEntrySource"/>
		<property name="throwException" value="true"/>
		<property name="useDefaultValue" value="false"/>
    </translator>
    <translator name="AVEApplicationSource_enum_translator" class="enum_translator">
        <property name="enumName" value="AVEApplicationSource"/>
		<property name="throwException" value="true"/>
		<property name="useDefaultValue" value="false"/>
    </translator>
    <translator name="AVContractMailingDestOrg_enum_translator" class="enum_translator">
        <property name="enumName" value="AVContractMailingDestOrg"/>
		<property name="throwException" value="true"/>
		<property name="useDefaultValue" value="false"/>
    </translator>
    
	<!--resolver name="user_resolver" class="batch_query_resolver">
		<property name="query"><![CDATA[
			SELECT usr FROM SCUser usr
					WHERE usr.LoginName = {0}
			]]></property>
		<property name="keys" value="string userid"/>
	</resolver-->
	<resolver name="user_resolver" class="com.aviva.fs.dms.tools.loader.resolve.AVOQLResolver">
		<property name="query" value = "SELECT usr.GID gid, usr.LoginName logName FROM SCUser user"/>
        <property name="gidAlias" value="gid"/>
        <property name="keys" value="logName"/>
    </resolver>
	<!--constant name="false constant" class="value">
		<property name="value" value="false"/>
	</constant-->
	<!--resolver name="party_resolver" class="batch_query_resolver">
		<property name="query"><![CDATA[
				SELECT party.GID g FROM FSParty party WHERE 
					(party.Party IN (SELECT org FROM SCOrganization org WHERE org.TaxID = {0}))
			]]></property>
		<property name="keys" value="string TaxID"/>
	</resolver-->
	<resolver name="party_resolver" class="com.aviva.fs.dms.tools.loader.resolve.AVOQLResolver">
		<property name="query"
			value="SELECT party.GID gid, ([SCOrganization]party.Party).TaxID taxid FROM FSParty party" />
		<property name="keys" value="taxid" />
		<property name="gidAlias" value="gid" />
	</resolver>
	<map object="org_party">
		<action name="update" resolver="party_resolver">
			<field name="tax id"/>
		</action>
		<map_simple property="Org.TaxID" field="tax id"/>
		<map_simple property="Org.Name" field="name"/>
		<map_simple property="Org.AgencyFormationDate" field="agency formation date"/>
		<map_simple property="Roles" field="role" tag="validator"/>
		<!--map_simple property="Org.Description" field="description"/-->
		<map_simple property="Org.DBA" field="dba"/>
		<!--map_simple property="Org.OrganizationType" field="organization type"/-->
		<map_simple property="Org.npn" field="npn"/>
		<map_simple property="Org.AVCRDNumber" field="crd number"/>
		<map_simple property="DTCCID" field="dtcc id"/>
		<!--map_simple property="PartyRole" field="party role"/-->
		<!--map_simple property="PartyType" field="party type"/-->
		<!--map_simple property="RenewalFeePayee" field="renewal fee payee"/-->
		<map_simple property="SyncPDB" field="syncWithPDB"/>
		<map_simple property="NewStatus.StatusCode" field="status code" tag="validator"/>
		<map_merge property="NewStatus.StatusReason" tag="validator" translator="status_reason_translator">
			<field name="status code"/>
			<field name="status reason"/>
		</map_merge>
		<map_simple property="NewStatus.StartDate" field="status start date" tag="validator"/>
		<map_simple property="NewStatus.EndDate" field="status end date" tag="validator"/>
		<!--map_object property="SCUser" resolver="user_resolver">
			<field name="usr"/>
		</map_object-->
		<map_simple property="AVInitialContractDate" field="Initial Contract Date"/>
		<map_simple property="Org.AVOrgType" field="organization type"/>
		<map_simple property="Org.AVBkgndChkWaivForAssocPerson" field="Background Check Waived for Assoc Persons"/>
		<map_simple property="Org.AVSellingAgrOnFile" field="Selling Agreement on File"/>
		<map_simple property="Org.AVSellingAgrVersion" field="Selling Agreement Version"/>
		<map_simple property="Org.AVSellingAgrDate" field="Selling Agreement Date"/>
		<map_simple property="Org.AVAMLExclForAssocPerson" field="AML Exclusion for Associated Person Parties"/>
		<map_simple property="Org.AVEOWaivForAssocParties" field="EO Waived for Associated Parties"/>
		<map_simple property="Org.AVBusinessType" field="Business Type"/>
		<map_merge property="AVLOPExemptUntilDate" translator="lop_date_translator">
			<field name="LOP Exempt Until Date"/>
		</map_merge>
		<map_simple property="AVLOPExemptReason" field="LOP Exempt Reason"/>
		<map_simple property="AVLOPExemptReqLastName" field="LOP Exempt Requester"/>
        
        <map_simple property="Org.AVCompDiscussed" field="Comp Discussed with Rep"/>
        <map_simple property="Org.AVRestrCommunication" field="Restricted Communication"/>
        <!--<map_simple property="Org.AVAdvofCommissions" field="Advancing Commissions"/>-->
        <map_simple property="Org.AVAdvChargebackTimeFrame" field="Advancing Chargeback Timeframe" translator="AVAdvancingChargebackTimeframe_enum_translator"/>
        <!--<map_simple property="Org.NettingOfCommissions" field="Netting of Commissions"/>-->
        <!--<map_simple property="Org.AVCustodialBusiness" field="Custodial Business"/>-->
        <!--<map_simple property="Org.AVOrderEntry" field="Order Entry"/>-->
        <map_simple property="Org.AVOrderEntSource" field="Order Entry Source" translator="AVOrderEntrySource_enum_translator"/>
        <map_simple property="Org.AVEApp" field="E-Application"/>
        <map_simple property="Org.AVEAppSource" field="E-Application  Source" translator="AVEApplicationSource_enum_translator"/>
        <map_simple property="Org.AVDIstAccIDReq" field="Distributor Account ID Required"/>
        <map_simple property="Org.AVDisAuthority" field="Dicretionary Authority"/>
        <map_simple property="Org.AVAccToWeb" field="Access to Website"/>
        <map_simple property="Org.AVEarnEligible" field="Earn Eligible"/>
        <map_simple property="Org.AVIncTripEligible" field="Incentive Trip Eligible"/>
        <map_simple property="Org.AVExpEligible" field="Experience Eligible"/>
        <map_simple property="Org.AVBackOffCode" field="Back Office Code"/>
        <!--<map_simple property="Org.AVSuitabilityDel" field="Suitability Delegation to BD or Bank"/>-->
        <map_simple property="Org.AVContractMailingDest" field="Contract Mailing Destination" translator="AVContractMailingDestOrg_enum_translator"/>
        <!--<map_simple property="Org.AVHeldCompBypass" field="Held Comp Bypass"/>-->
        <map_simple property="Org.AVDOLEffectiveDate" field="DOL Effective Date"/>
        <map_simple property="Org.AVDOLFIStatus" field="DOL FI Status" translator="fi_status_translator"/>
        <map_simple property="Org.AVAdvanceClientIntFunds" field="AVAdvOnClientInitFunds"/>
        <map_simple property="AVIPCOnFile" field="AVIPCOnFile"/>
        <map_simple property="AVIPCEffectiveDate" field="AVIPCEffectiveDate"/>
		<map_simple property="AVIPCVersion" field="AVIPCVersion"/>
	</map>
</loader:loader_spec>
