<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 *      Copyright (C) Unpublished Versata Inc. All riths reserved.
 *      Versata, Inc., Confidential and Proprietary.
 *      This software is subject to copyright protection
 *      under the laws of the United States and other countires.
 *      Unless otherwise explicitly stated, this software is provided
 *      by Versata "AS IS".
 */
 -->
<loader:loader_spec xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:loader="http://dms.trilogy.com/Loader/Spec" xmlns="http://dms.trilogy.com/Loader/Spec" xsi:schemaLocation="http://dms.trilogy.com/Loader/Spec LoaderSpec.xsd" name="FIAgreement Loader Spec">
	<error_handlers>
		<handler name="idea_log_error_handler" class="log_message_error_handler">
			<property name="filename" value="${OUTPUT_DIR}/${ERROR_FILENAME}"/>
		</handler>
	</error_handlers>
	<strategy name="strategy" class="${STRATEGY}">
		<property name="memory.batch_size" value="${BATCH_SIZE}"/>
		<property name="exitIfSanityCheckFails" value="${SANITY_CHECK}"/>
		<!--property name="numThreads" value="4"/-->
	</strategy>
	<object name="fi_agreements" class="AVFIAgreementValidator"/>
	<source name="load_file" class="delimited_file_parser">
		<property name="filename" value="${FILENAME}"/>
		<property name="delimiters" value=","/>
		<property name="headerRows" value="1"/>
		<!--property name="footerRows" value="1"/-->
		<property name="quote_chars" value="&quot;"/>
		<indexed_field name="PartyID" index="0"/>
		<indexed_field name="FIAgreementGID" index="1"/>
        <indexed_field name="agreement name" index="2" translator="agreement_name_translator"/>
		<indexed_field name="applicable" index="3" translator="yes_no_translator"/>
		<indexed_field name="on file" index="4" translator="yes_no_translator"/>
		<indexed_field name="version" index="5"/>
		<indexed_field name="date" index="6"  translator="date_translator"/>
		<indexed_field name="end date" index="7"  translator="date_translator"/>		
	</source>
	<translator name="agreement_name_translator" class="enum_translator">
		<property name="enumName" value="AVFIAgreementName"/>
	</translator>
	<translator name="yes_no_translator" class="enum_translator">
		<property name="enumName" value="AVYesNo"/>
	</translator>
	<translator name="date_translator" class="date_format_translator">
		<property name="formatString" value="MM/dd/yyyy"/>
	</translator>
    <resolver name="party_resolver" class="com.aviva.fs.dms.tools.loader.resolve.AVOQLResolver">
		<!--property name="query" value="SELECT party.GID gid, ([SCOrganization]party.Party).TaxID taxid FROM FSParty party" /-->
		<property name="query" value="SELECT party.GID gid, party.UNID partyID FROM FSParty party" />
		<property name="keys" value="partyID" />
		<property name="gidAlias" value="gid" />
	</resolver>    
    <resolver name="fi_agreement_resolver" class="com.aviva.fs.dms.tools.loader.resolve.AVOQLResolver">
		<property name="query"
            value="SELECT fiagreement.GID gid, fiagreement.GID fiagreementGID FROM AVFIAgreement fiagreement" />
		<property name="keys" value="fiagreementGID" />
		<property name="gidAlias" value="gid" />
	</resolver>	
	<constant name="invokedByUI" class="java_static_field">
		<property name="className" value="java.lang.Boolean"/>
		<property name="fieldName" value="FALSE"/>
	</constant>
	
	<map object="fi_agreements">
		<action name="update or insert" resolver="fi_agreement_resolver">
			<field name="FIAgreementGID"/>
		</action>
        <map_object property="FSParty"  resolver="party_resolver" validator="true">
			<field name="PartyID"/>
		</map_object>
		<map_simple property="AVName" field="agreement name"/>
		<map_simple property="AVOnfile" field="on file"/>  
		<map_simple property="AVApplicable" field="applicable"/>  
        <map_simple property="AVVersion" field="version"/>
        <map_simple property="AVDate" field="date"/>
        <map_simple property="AVEndDate" field="end date"/>
		<map_constant property="InvokedByUI" constant="invokedByUI" tag="validator"/>		
	</map>
</loader:loader_spec>
